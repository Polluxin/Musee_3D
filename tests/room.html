<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Juicy cube</title>
  <style>
    body { margin: 0; }
  </style>
</head>
<body>
<script type="importmap">
	{
	"imports": {
		"three": "https://unpkg.com/three/build/three.module.js",
		"three/addons/": "https://unpkg.com/three/examples/jsm/"
	}
	}
</script>

<script type="module">

  import * as THREE from 'three';
  import {GLTFLoader} from 'three/addons/loaders/GLTFLoader.js';
  import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
  import {PlaneGeometry} from "three";

  /**********************************************************************************
    Scene
   **********************************************************************************/
  const scene = new THREE.Scene();

  /**********************************************************************************
    Light
   **********************************************************************************/
  const spotLight = new THREE.DirectionalLight(0xffffff, 0.5);
  spotLight.position.set(4,10,5);
  scene.add(spotLight);

  const sunLight = new THREE.AmbientLight(0xffffff, 0.5);
  sunLight.position.set(10,10,10);
  scene.add(sunLight);

  /**********************************************************************************
    Camera
   **********************************************************************************/
  const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

  camera.position.set(0,10,0);

  /**********************************************************************************
   Helpers
   **********************************************************************************/
  // const helper = new THREE.DirectionalLightHelper( spotLight, 5 );
  // scene.add( helper );

  // const size = 10;
  // const divisions = 10;
  // const gridHelper = new THREE.GridHelper( size, divisions );
  // scene.add( gridHelper );

  const axesHelper = new THREE.AxesHelper( 20 );
  scene.add( axesHelper );

  /**********************************************************************************
    Window & Render
   **********************************************************************************/
  window.onresize = function () {

    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    renderer.setSize( window.innerWidth, window.innerHeight );

  };

  const renderer = new THREE.WebGLRenderer();
  renderer.setSize( window.innerWidth, window.innerHeight );
  document.body.appendChild( renderer.domElement );


  /**********************************************************************************
     Control
   **********************************************************************************/
  const controls = new OrbitControls( camera, renderer.domElement );


  /**********************************************************************************
     Models loading
   **********************************************************************************/
  let room;
  const loader = new GLTFLoader();
  loader.load( 'room.glb', function ( gltf ) {

    room = gltf;
    scene.add( gltf.scene );
  }, undefined, function ( error ) {

    console.error( error );
  } );

  /**********************************************************************************
     Geometry
   **********************************************************************************/
  // Insert image :
  //  var loader = new THREE.TextureLoader();
  //  var material = new THREE.MeshLambertMaterial({
  //            map: loader.load('https://s3.amazonaws.com/duhaime/blog/tsne-webgl/assets/cat.jpg')
  //          });


  // Create a 1x1x1 color cube
  function create_cube(color){
    const geometry = new THREE.BoxGeometry( 1, 1, 1 );
    const material = new THREE.MeshPhongMaterial( { color: color } );
    return new THREE.Mesh(geometry, material);
  }

  // Place object on scene roof at position (x,y,z)
  function place(obj,x,y,z){
    scene.add( obj );
    obj.position.set(x,y,z);
  }

  // Give the size in a vec3 of object obj
  function getSize(obj) {
    let measure = new THREE.Vector3();
    obj.geometry.computeBoundingBox();
    obj.geometry.boundingBox.getSize(measure);
    return measure;
  }


  /**********************************************************************************
    Room Layout
   **********************************************************************************/

  // Function that add image on top of object obj
  function addItem(obj, image){
    let measure = new THREE.Vector3();
    let plane = new PlaneGeometry(1,1);
    obj.geometry.computeBoundingBox();
    obj.geometry.boundingBox.getSize(measure);

    let i = new THREE.Mesh(plane, image);
    scene.add(i);

    i.position.set(obj.position.x, obj.position.y + measure.y, obj.position.z);
  }

  function addPresenters(){
    let p = create_cube(0xE75900);
    place(p, -2, 0.5, -2);

    const loader = new THREE.TextureLoader();
    const i = new THREE.MeshLambertMaterial({
      map: loader.load('https://s3.amazonaws.com/duhaime/blog/tsne-webgl/assets/cat.jpg'),
      side: THREE.DoubleSide
    });
    addItem(p, i);

    let p2 = create_cube(0xE75900);
    place(p2, -2, 0.5, 2);
    addItem(p2, i);

    let p3 = create_cube(0xE75900);
    place(p3, 2, 0.5, -2);
    addItem(p3, i);

    let p4 = create_cube(0xE75900);
    place(p4, 2, 0.5, 2);
    addItem(p4, i);

  }

  addPresenters();

  /**********************************************************************************
   Animation
   **********************************************************************************/
  function animate(){
    requestAnimationFrame( animate );
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

</script>
</body>
</html>